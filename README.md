# Предыстория от основателя

Однажды наш тёплый ламповый [Аниме-фест Yuki no Odori](http://tulafest.ru) решил переехать на убер-крутую
платформу для организации Аниме-фестов [Cosplay2](http://cosplay2.ru). Мы начали принимать заявки, а потом выяснилось,
что программа [Генератор слайдов](https://vk.com/cosplay2ru?w=wall-64774987_208%2Fall), которая по идее призвана
скачивать файлы участников, вообще говоря, говно... А еще, очень очень хотелось иметь все данные заявок данные в
одной базе данных, чтобы писать к ней SQL-запросы и генерировать всякие полезные списки (встроенная генерилка списков
гибкостью не блещет). Так и родился этот репозиторий.

# Что уже написано
* [get_data.py](get_data.py)
    * Загрузка всех данных из всех заявок на фестиваль.
    * Генерация базы данных SQLite из этих данных.
* [get_files.py](get_files.py)
    * Загрузка всех файлов из всех заявок.
    * Для каждой номинации своя папка
    * Имена файлов составляются из номера заявки и названия карточки. Если у вас нет названий карточек, сгенерируйте их или нагородите LEFT JOIN'ов в SQL (не рекомендуется, но вот [пример](https://github.com/Himura2la/Cosplay2-Downloader/blob/cr17/get_files.py#L51)).
* [testcafe-broadcaster.js](testcafe-broadcaster.js)
    * Позволяет сделать рассылку всем участникам одной командой.
    * Использует [TestCafe](https://github.com/DevExpress/testcafe).

## Мелкие ad-hoc скрипты, родившиеся в процессе подготовки материалов

* [checker.py](checker.py) -- скрипт, проверяющий все ли файлы на месте (обязательно перепровертье вручную в самом
конце, **это архи-важно**. Я уже два феста подряд просераю AMV-шки из за пренебрежения ручной проверкой).
* `csv_renamer.py` - для фестов, которые не через к2. Делает имена файлов для FestEngine из таблицы
* [program_cleaner.py](program_cleaner.py) -- скрипт для очистки программы феста от лишних строк (для сверки выложенной
ВК программы с программой, из раздела к2 "Планирование расписания").
* [renamer.py](renamer.py) -- скрипт для переименования файлов в соответствии с номерами по программе. Ибо номера по
программе появляются незадолго до феста, а файлы хорошо бы уже давно иметь на диске (загружаются они с номерами заявок).
Мы делаем сквозную нумерацию карточек по всему фесту, чтобы можно было с её помощью сортировать файлы
([пример](https://vk.com/topic-20362122_35064985)).
* [image_list_gen.py](image_list_gen.py) -- Генерилка списка путей к картинкам для вставки в CSV файл, который
используется для определения переменных фотошопе при генерации задников. Если вы ничего не поняли, [начните отсюда](http://www.richmediacs.com/user_manuals/RMCS_PS_Training/Using%20PS%20Variables/UsingVariablesInPS_EXTERNAL.html)
* Куча полезных SQL запросов, можно хватать идеи по работе с БД. Особенно полезен файл [задники.sql](sql/задники.sql),
мне очень мешало то, что я вспомнил про **JOIN** не сразу и по-началу городил **CREATE TEMP TABLE AS SELECT**...

## Папка `etc`
Это необязательные скрипты, которые либо легаси, либо не имеют прямого отношения к теме репа.

* `compare_folders.py` - скрипт сверки папок, можете заменить на [meld](http://meldmerge.org/) или обычный diff
* `gui.py` - Заготовка GUI на wxWidgets, до рефакторинга с YAML-конфигом
* `regex_renamer.py` - переименователь по регэкспам
* `sql_query.py` - выполняет SQL в указанной базе SQLite. Там есть очень полезная фича - делать плоские тексты с длинными полями, для пожеланий по стаффу волонтёрам и светосценариев.


# Как запускать
* Cкопировать `config.yml.example` в `config.yml` и отредактировать под себя. Там есть комментарии.
* Создать папку `домен_фестиваля`, указать её в конфиге
* Запустить `python3 get_data.py`
* Проверить, что всё в порядке.

Если стрёмно хранить пароль админа без шифрования, можно его не вводить в конфиге, тогда программа будет сама спрашивать (не чаще 1 раза в 10 минут).
